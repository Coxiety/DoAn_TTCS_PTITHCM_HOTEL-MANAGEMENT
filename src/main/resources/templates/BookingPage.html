<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <title>Booking Page</title>
        <!-- Include both CSS files -->
        <link rel="stylesheet" th:href="@{/css/stylesHome.css}" />
        <link rel="stylesheet" th:href="@{/css/stylesBooking.css}" />
    </head>
    <body>
        <!-- Messages -->
        <div th:if="${error}" class="alert alert-error" th:text="${error}">
        </div>
        <div th:if="${success}" class="alert alert-success" th:text="${success}">
        </div>

        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo">
                LOGO
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#">Contract</a>
                </li>
                <li>
                    <a href="#">Home</a>
                </li>
                <li>
                    <a href="#">Introduction</a>
                </li>
                <!-- Show these if user is not logged in -->
                <li th:if="${session.user == null}">
                    <a href="#" class="btn login-btn">Login</a>
                </li>
                <li th:if="${session.user == null}">
                    <a href="#" class="btn signup-btn">Sign-up</a>
                </li>
                <!-- Show these if user is logged in -->
                <li th:if="${session.user != null}">
                    <span th:text="${session.user.fullName}"></span>
                </li>
                <li th:if="${session.user != null}">
                    <form action="/auth/logout" method="POST" style="display: inline;">
                        <button type="submit" class="btn">Logout</button>
                    </form>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main>
            <!-- LEFT COLUMN: Rooms List -->
            <section class="rooms-section">
                <!-- Standard Room -->
                <div class="room-card">
                    <div class="room-image">
                    </div>
                    <div class="room-details">
                        <h2>Standard Room</h2>
                        <div class="bed-price-info">
                            <img src="/img/icon/bedIcon.png" alt="Bed Icon" class="bed-icon" />
                            <span class="beds-count">X2</span>
                            <span class="price-tag">Price: $100</span>
                        </div>
                        <div class="room-options">
                            <button class="btn availability-btn">Available 5</button>
                            <select class="room-select">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Deluxe Room -->
                <div class="room-card">
                    <div class="room-image">
                    </div>
                    <div class="room-details">
                        <h2>Deluxe Room</h2>
                        <div class="bed-price-info">
                            <img src="/img/icon/bedIcon.png" alt="Bed Icon" class="bed-icon" />
                            <span class="beds-count">X3</span>
                            <span class="price-tag">Price: $150</span>
                        </div>
                        <div class="room-options">
                            <button class="btn availability-btn">Available 5</button>
                            <select class="room-select">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Executive Suite -->
                <div class="room-card">
                    <div class="room-image">
                    </div>
                    <div class="room-details">
                        <h2>Executive Suite</h2>
                        <div class="bed-price-info">
                            <img src="/img/icon/bedIcon.png" alt="Bed Icon" class="bed-icon" />
                            <span class="beds-count">X4</span>
                            <span class="price-tag">Price: $200</span>
                        </div>
                        <div class="room-options">
                            <button class="btn availability-btn">Available 5</button>
                            <select class="room-select">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RIGHT COLUMN: Phone-like summary box -->
            <section class="summary-section">
                <div class="phone-mockup">
                    <div class="phone-header">
                    </div>
                    <div class="phone-content">
                        <p>Total Rooms: <span id="totalRooms">0</span></p>
                        <p>Total Price: $<span id="totalPrice">0</span></p>
                        <p>Check-in date:</p>
                        <div class="calendar-icon" id="calendarIcon">
                            ðŸ“…
                        </div>
                        <input type="date" id="checkInDate" style="display:none;" />
                    </div>
                    <button class="btn book-btn">Book</button>
                </div>
            </section>
        </main>

        <!-- Include Auth Modals -->
        <div th:replace="~{fragments/auth-modals :: loginModal}">
        </div>
        <div th:replace="~{fragments/auth-modals :: signupModal}">
        </div>

        <!-- Include Room Detail Modal -->
        <div th:replace="~{fragments/room-modals :: roomDetailModal}">
        </div>

        <!-- Include Modal Scripts -->
        <div th:replace="~{fragments/auth-modals :: modalScripts}">
        </div>
        <div th:replace="~{fragments/room-modals :: roomDetailScripts}">
        </div>

        <!-- Booking specific scripts -->
        <script>
            // Room prices configuration
            const roomPrices = {
                "standard": 100,
                "deluxe": 150,
                "suite": 200
            };
            
            const roomSelects = document.querySelectorAll('.room-select');
            const totalRoomsEl = document.getElementById('totalRooms');
            const totalPriceEl = document.getElementById('totalPrice');

            // Handle room selection from the main page cards
            roomSelects.forEach((select, index) => 
            {
                select.addEventListener('change', function() 
                {
                    updateTotals();
                });
            });

            // Calculate totals from all selected rooms
            function updateTotals() 
            {
                let totalRooms = 0;
                let totalPrice = 0;
                const roomTypes = ['standard', 'deluxe', 'suite'];
                
                roomSelects.forEach((select, index) => 
                {
                    const selectedRooms = parseInt(select.value, 10);
                    if (selectedRooms > 0)
                    {
                        const roomType = roomTypes[index];
                        const price = roomPrices[roomType];
                        
                        totalRooms += selectedRooms;
                        totalPrice += selectedRooms * price;
                    }
                });
                
                totalRoomsEl.textContent = totalRooms;
                totalPriceEl.textContent = totalPrice;
            }

            // Calendar handling
            const calendarIcon = document.getElementById('calendarIcon');
            const checkInDate = document.getElementById('checkInDate');

            calendarIcon.addEventListener('click', () => 
            {
                if (checkInDate.showPicker) 
                {
                    checkInDate.showPicker();
                } 
                else 
                {
                    checkInDate.style.display = 'inline-block';
                    checkInDate.focus();
                }
            });
        </script>
    </body>
</html>
