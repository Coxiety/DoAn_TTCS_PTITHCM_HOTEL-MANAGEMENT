<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- Room Detail Modal Fragment -->
    <div th:fragment="roomDetailModal">
        <div id="modalOverlayRoomDetail" class="modal-overlay">
            <div class="modal room-detail-modal">
                <span id="closeModalRoomDetail" class="close-button">&times;</span>
                <div class="room-detail-content">
                    <!-- Room Image (placeholder) -->
                    <div class="room-detail-image" id="detailRoomImage">
                        <!-- Image will be set dynamically -->
                        <p style="text-align:center;">Room Image</p>
                    </div>
                    
                    <!-- Title -->
                    <h2 class="modal-title" id="detailRoomTitle">Room Details</h2>
                    
                    <!-- Basic Info: type, capacity, price, status -->
                    <div class="room-info">
                        <p class="room-type">Type: <span id="roomTypeDetail"></span></p>
                        <p class="room-capacity">Capacity: <span id="roomCapacityDetail"></span> persons</p>
                        <p class="room-price">Price: $<span id="roomPriceDetail"></span> per night</p>
                        <p class="room-status">Status: <span id="roomStatusDetail"></span></p>
                    </div>
                    
                    <!-- Description -->
                    <div class="room-description">
                        <h3>Description</h3>
                        <p id="roomDescriptionDetail"></p>
                    </div>
                    
                    <!-- Amenities -->
                    <div class="room-amenities">
                        <h3>Amenities</h3>
                        <ul id="roomAmenitiesList"></ul>
                    </div>
                    
                    <!-- Booking controls (Available, dropdown, Add to Book) -->
                    <div class="modal-booking-controls">
                        <button class="btn availability-btn" id="modalAvailableBtn">
                            Available 5
                        </button>
                        <select class="room-select" id="modalRoomSelect">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                        <button class="btn modal-add-btn" id="modalAddBtn">
                            Add to Book
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room Detail Scripts Fragment -->
    <div th:fragment="roomDetailScripts">
        <script>
            const roomCards = document.querySelectorAll('.room-card');
            const modalOverlayRoomDetail = document.getElementById('modalOverlayRoomDetail');
            const closeModalRoomDetail = document.getElementById('closeModalRoomDetail');
            const totalRoomsEl = document.getElementById('totalRooms');
            const totalPriceEl = document.getElementById('totalPrice');

            // Sample room data (replace with actual data from backend)
            const roomData = 
            {
                "standard": 
                {
                    type: "Standard Room",
                    capacity: 2,
                    price: 100,
                    status: "Available",
                    description: "A comfortable standard room with essential amenities.",
                    amenities: ["Wi-Fi", "TV", "Air Conditioning", "Private Bathroom"],
                    availableCount: 5
                },
                "deluxe": 
                {
                    type: "Deluxe Room",
                    capacity: 3,
                    price: 150,
                    status: "Available",
                    description: "Spacious deluxe room with premium furnishings and city view.",
                    amenities: ["Wi-Fi", "TV", "Air Conditioning", "Mini Bar", "Safe", "City View"],
                    availableCount: 5
                },
                "suite": 
                {
                    type: "Executive Suite",
                    capacity: 4,
                    price: 200,
                    status: "Available",
                    description: "Luxurious suite with separate living area and premium amenities.",
                    amenities: ["Wi-Fi", "TV", "Air Conditioning", "Mini Bar", "Safe", "Living Room", "Bathtub", "Ocean View"],
                    availableCount: 5
                }
            };

            // Store current room type to use in the Add to Book button
            let currentRoomType = "";

            function showRoomDetails(roomType) 
            {
                currentRoomType = roomType;
                const room = roomData[roomType];
                
                // Update text fields
                document.getElementById('roomTypeDetail').textContent = room.type;
                document.getElementById('roomCapacityDetail').textContent = room.capacity;
                document.getElementById('roomPriceDetail').textContent = room.price;
                document.getElementById('roomStatusDetail').textContent = room.status;
                document.getElementById('roomDescriptionDetail').textContent = room.description;
                
                // Update amenities list
                const amenitiesList = document.getElementById('roomAmenitiesList');
                amenitiesList.innerHTML = room.amenities
                    .map(amenity => `<li>${amenity}</li>`)
                    .join('');
                
                // Update availability button text
                document.getElementById('modalAvailableBtn').textContent = "Available " + room.availableCount;
                
                // Reset the dropdown to 0
                document.getElementById('modalRoomSelect').value = "0";
                
                // Display modal
                modalOverlayRoomDetail.style.display = 'flex';
            }

            // Add click event to room headings
            roomCards.forEach((card, index) => 
            {
                const heading = card.querySelector('h2');
                const roomTypes = ['standard', 'deluxe', 'suite'];
                
                heading.style.cursor = 'pointer';
                heading.addEventListener('click', () => 
                {
                    showRoomDetails(roomTypes[index]);
                });
            });

            // Add to Book button handler
            document.getElementById('modalAddBtn').addEventListener('click', function() 
            {
                const numRooms = parseInt(document.getElementById('modalRoomSelect').value, 10);
                if (numRooms > 0) 
                {
                    const roomPrice = roomData[currentRoomType].price;
                    addToBooking(numRooms, roomPrice);
                    // Optionally close the modal after adding to booking
                    modalOverlayRoomDetail.style.display = 'none';
                }
            });

            // Function to update the booking summary
            function addToBooking(numRooms, roomPrice) 
            {
                // Get current totals from the summary
                const currentRooms = parseInt(totalRoomsEl.textContent, 10);
                const currentPrice = parseInt(totalPriceEl.textContent, 10);
                
                // Add the newly chosen rooms
                const newRooms = currentRooms + numRooms;
                // Calculate new price based on specific room price
                const newPrice = currentPrice + (roomPrice * numRooms);
                
                // Update the summary display
                totalRoomsEl.textContent = newRooms;
                totalPriceEl.textContent = newPrice;
            }

            // Close modal handlers
            closeModalRoomDetail.addEventListener('click', () => 
            {
                modalOverlayRoomDetail.style.display = 'none';
            });

            window.addEventListener('click', (e) => 
            {
                if (e.target === modalOverlayRoomDetail) 
                {
                    modalOverlayRoomDetail.style.display = 'none';
                }
            });
        </script>
    </div>
</body>
</html>